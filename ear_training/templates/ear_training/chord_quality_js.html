{% load static %}

<script>
    const playButton = document.getElementById('playButton');
    playButton.addEventListener('click', () => {
        /* 0, 1, 2, 3 - major, minor, dim, aug */
        var chordQuality = Math.floor(Math.random() * 4);

        /*
        C0 - B0: 12 semitones
        C1 - B1: 12 semitones
        C2 - B2: 12 semitones
        C3 - B3: 12 semitones
        ...
        C7 - B7: 12 semitones
        C8: 1 semitone

        total 12*8 + 1 = 85 semitones.
        so r (root) can go from 0 to 85 - 8 = 77
        */
        let r = Math.floor(Math.random() * (50 - 20)) + 20;

        let chordTones = [
            [0, 4, 7], /* major */
            [0, 3, 7], /* minor */
            [0, 3, 6], /* dim */
            [0, 4, 8] /* aug */
        ]

        console.log(chordQuality);
        playChord(chordTones[chordQuality].map((note) => r + note));
    });

    function playChord(arrayOfNotes) {
        const numberOfNotes = arrayOfNotes.length;
        let arrayOfAudioPlayers = [];
        for (i = 0; i < numberOfNotes; i++) {
            noteFilename = noteNameFromSemitones(arrayOfNotes[i])
                                    + octaveFromSemitones(arrayOfNotes[i]) + '.mp3';
            arrayOfAudioPlayers[i] = document.createElement('audio');
            arrayOfAudioPlayers[i].src = "{% static 'ear_training/piano_notes/' %}" + noteFilename;
        }

        for (i = 0; i < numberOfNotes; i++) {
            arrayOfAudioPlayers[i].play();
        }
    }

    function noteNameFromSemitones(semitones) {
        const allNotes = ['c', 'db', 'd', 'eb', 'e', 'f',
                        'gb', 'g', 'ab', 'a', 'bb', 'b'];

        return allNotes[semitones % 12];
    }

    function octaveFromSemitones(semitones) {
        return Math.floor(semitones / 12);
    }
</script>